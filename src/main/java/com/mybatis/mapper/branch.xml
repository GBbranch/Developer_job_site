<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Branch">
<!-- 구인글 생성 -->
	<insert id="article-insert" parameterType="articledto">
		BEGIN
		<selectKey resultType="int" keyProperty="id" order="BEFORE">
        	SELECT ARTICLE_SEQ.nextval FROM dual
    	</selectKey> 
				INSERT INTO "article" a VALUES (
			#{id}
			,	#{title}
			,	#{company_id}
			,	#{career}
			,	#{salary}
			,	(SELECT ad.ID FROM ADDRESS ad WHERE ad.DISTRICT = #{address})
			,	#{detail_addr}
			,	#{need_amt}
			,	#{job_explain}
			,	#{deadline}
			,	#{qualify}
		)
		;
								INSERT INTO JOB j (
					j.ID ,
					j.ARTICLE_ID ,
					j.NAME
				)
				SELECT JOB_SEQ.nextval, B.* FROM (
				<foreach collection="job" item="name" separator="UNION ALL">
					SELECT
						#{id},
						#{name}
					FROM dual
				</foreach>
		)B;		
				INSERT INTO "skill_stack" ss (
			ss."id" ,
			ss."article_id" ,
			ss."name" 
		)
		SELECT JOB_SEQ.nextval, C.* FROM (
		<foreach collection="skill_stack" item="name" separator="UNION ALL">
			SELECT 
				#{id},
				#{name}
			FROM dual
		</foreach>
		)C;
		END;
	</insert>
	<select id="article-select" parameterType="_int" resultType="articledto">
		SELECT * FROM "article" a WHERE a."id" = #{id}
	</select>
	<select id="job-select" parameterType="_int" resultType="string">
		SELECT j.NAME FROM JOB j WHERE j.ARTICLE_ID = #{id}
	</select>
	<select id="stack-select" parameterType="_int" resultType="string">
		SELECT ss."name" FROM "skill_stack" ss WHERE ss."article_id" = #{id}
	</select>
	<select id="address-select" parameterType="_int" resultType="string">
		SELECT a2.DISTRICT || a."detail_addr" AS address FROM "article" a 
	LEFT OUTER JOIN ADDRESS a2 
		ON a."address_id" = a2.ID
WHERE a."id" = #{id} 
	</select>
</mapper>







